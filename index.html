<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Love Story ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Mali:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        * { box_sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Mali', cursive;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            background-color: #ffdde1;
            width: 100vw; height: 100vh; overflow: hidden; position: relative;
        }

        /* --- Card ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• --- */
        .card {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); 
            padding: 2rem; border-radius: 30px;
            box-shadow: 0 20px 50px rgba(255, 105, 180, 0.5); 
            text-align: center;
            width: 90%; max-width: 600px;
            z-index: 10; border: 5px solid #fff;
            max-height: 90vh; overflow-y: auto;
        }

        h1 { color: #ff4081; font-size: 2.5rem; margin-bottom: 1.5rem; }
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; color: #d81b60; font-weight: bold; margin-bottom: 5px; font-size: 1.2rem; text-align: center; }
        
        input {
            width: 100%; padding: 12px; border: 3px solid #ffc1e3; border-radius: 50px;
            font-family: 'Mali', cursive; text-align: center; background: #fff0f6; outline: none; font-size: 1.2rem;
        }

        /* ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ã‡πâ‡∏≠‡∏ô Input ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà */
        .date-wrapper {
            position: relative;
            width: 100%;
        }
        /* ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Text) */
        #date-display {
            background: #fff0f6;
            color: #333;
            cursor: pointer;
        }
        /* ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á) */
        #date {
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            opacity: 0; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô ‡πÅ‡∏ï‡πà‡∏Å‡∏î‡πÑ‡∏î‡πâ */
            cursor: pointer;
            z-index: 2;
        }

        .upload-row { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 20px; }
        .upload-btn {
            background: #ffb6c1; color: white; padding: 10px; border-radius: 15px;
            font-size: 1rem; cursor: pointer; width: 48%; text-align: center;
            border: 2px solid #ff69b4; display: flex; flex-direction: column; align-items: center;
        }
        input[type="file"] { display: none; }
        
        button {
            border: none; padding: 15px; font-size: 1.3rem; border-radius: 50px; cursor: pointer;
            width: 100%; margin-top: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-family: 'Itim', cursive; transition: 0.3s; color: white;
        }
        button:hover { transform: translateY(-3px); }

        .calc-btn { background: linear-gradient(45deg, #ff4081, #ff80ab); font-size: 1.5rem; }
        .share-web-btn { background: #4CAF50; font-size: 1.1rem; margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* --- Pop-up ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; backdrop-filter: blur(5px);
            align-items: center; justify-content: center; overflow-y: auto; padding: 20px;
        }
        
        .modal-container {
            display: flex; flex-direction: column; align-items: center; gap: 20px;
            max-height: 95vh;
        }

        #capture-area {
            width: 450px; min-height: 800px; 
            background: linear-gradient(0deg, #ffdde1 0%, #ee9ca7 100%);
            padding: 60px 30px; border-radius: 25px;
            display: flex; flex-direction: column; align-items: center; 
            justify-content: space-between; position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); border: 12px solid white; gap: 20px;
        }

        .capture-content-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; flex-grow: 1; justify-content: center; }
        .story-title { font-family: 'Itim', cursive; font-size: 2.8rem; color: #ff4081; text-shadow: 3px 3px 0 white; margin: 10px 0; }
        .photo-couple { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; align-items: center; }
        .circle-img { width: 130px; height: 130px; border-radius: 50%; border: 6px solid #ff4081; object-fit: cover; background: white; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .heart-icon { font-size: 3rem; animation: pulse 1s infinite; color: #ff1493; text-shadow: 2px 2px 0 white; }
        .names-display { color: #d81b60; font-size: 2.2rem; margin-bottom: 25px; font-weight: bold; text-shadow: 2px 2px 0 white; }
        .time-box { background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 25px; margin-bottom: 20px; width: 95%; text-align: center; box-shadow: 0 10px 20px rgba(255, 105, 180, 0.3); }
        .big-number { font-size: 3rem; font-weight: bold; color: #ff4081; }
        .unit-text { font-size: 1.2rem; color: #880e4f; }
        .seconds-box { background: #ff4081; color: white; width: 95%; text-align: center; padding: 15px; border-radius: 20px; box-shadow: 0 10px 20px rgba(255, 20, 147, 0.4); margin-bottom: auto; }
        .seconds-number { font-size: 2rem; font-weight: bold; display: block; }
        .footer-text { color: white; font-size: 1.4rem; opacity: 0.9; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom: 10px; }

        /* --- Popup QR Code --- */
        #qr-popup {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 3000;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .qr-card {
            background: white; padding: 30px; border-radius: 30px; text-align: center;
            border: 5px solid #4CAF50; animation: popUp 0.3s ease;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        @keyframes popUp { 0% { transform: scale(0.5); } 100% { transform: scale(1); } }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; width: 100%; justify-content: center; padding-bottom: 30px; }
        .dl-btn { background: #00bfff; }
        .close-btn { background: #666; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .heart { position: absolute; top: -100px; color: #ff4081; animation: fall linear forwards; z-index: 1; pointer-events: none; }
        @keyframes fall { to { transform: translateY(120vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div class="card">
        <h1>üíò Love Calculator</h1>

        <div class="upload-row">
            <label class="upload-btn">
                <span>üì∏ ‡∏£‡∏π‡∏õ‡∏Ñ‡∏∏‡∏ì</span>
                <input type="file" id="p1" accept="image/*" onchange="readURL(this, 'preview1', 'img1_res')">
                <img id="preview1" style="width:40px; height:40px; border-radius:50%; display:none; margin-top:5px; object-fit:cover;">
            </label>
            <label class="upload-btn">
                <span>üì∏ ‡∏£‡∏π‡∏õ‡πÅ‡∏ü‡∏ô</span>
                <input type="file" id="p2" accept="image/*" onchange="readURL(this, 'preview2', 'img2_res')">
                <img id="preview2" style="width:40px; height:40px; border-radius:50%; display:none; margin-top:5px; object-fit:cover;">
            </label>
        </div>

        <div class="input-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
            <input type="text" id="n1" placeholder="‡∏Ñ‡∏∏" >
        </div>
        <div class="input-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å</label>
            <input type="text" id="n2" placeholder="‡∏´‡∏ß‡∏≤‡∏ô‡∏à‡∏∏‡∏¢" >
        </div>
        <div class="input-group">
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô</label>
            <div class="date-wrapper">
                <input type="text" id="date-display" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ" readonly>
                <input type="date" id="date" onchange="updateDateDisplay()">
            </div>
        </div>

        <button class="calc-btn" onclick="calc()">‚ù§Ô∏è ‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‚ù§Ô∏è</button>
        
        <button class="share-web-btn" onclick="showWebQR()">
            üì≤ QR Code ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô
        </button>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-container">
            <div id="capture-area">
                <div class="story-title">Happy Anniversary! ‚ú®</div>
                <div class="capture-content-wrapper">
                    <div class="photo-couple">
                        <img id="img1_res" class="circle-img" src="https://via.placeholder.com/150?text=Me">
                        <div class="heart-icon">‚ù§Ô∏è</div>
                        <img id="img2_res" class="circle-img" src="https://via.placeholder.com/150?text=You">
                    </div>
                    <div class="names-display" id="names-show"></div>
                    <div class="time-box">
                        <span id="y" class="big-number">0</span> <span class="unit-text">‡∏õ‡∏µ</span> &nbsp;
                        <span id="m" class="big-number">0</span> <span class="unit-text">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span> &nbsp;
                        <span id="d" class="big-number">0</span> <span class="unit-text">‡∏ß‡∏±‡∏ô</span>
                    </div>
                    <div class="seconds-box">
                        <div style="font-size: 1rem;">Together for</div>
                        <span id="s" class="seconds-number">0</span>
                        <div style="font-size: 1rem;">Seconds</div>
                    </div>
                </div>
                <div class="footer-text">luv U üíñ</div>
            </div>
            <div class="btn-group">
                <button class="btn dl-btn" onclick="downloadImage()">üì• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</button>
                <button class="btn close-btn" onclick="closeModal()">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <div id="qr-popup" onclick="closeQR()">
        <div class="qr-card" onclick="event.stopPropagation()">
            <h2 style="color:#4CAF50; margin-bottom:15px;">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö üëá</h2>
            <div id="qrcode" style="display:flex; justify-content:center;"></div>
            <p style="margin-top:15px; color:#555;">‡∏™‡πà‡∏á QR ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
            <button class="btn close-btn" style="margin-top:20px;" onclick="closeQR()">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô ‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ
        function updateDateDisplay() {
            const rawDate = document.getElementById('date').value;
            if (rawDate) {
                // rawDate ‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
                const parts = rawDate.split('-');
                const year = parts[0];
                const month = parts[1];
                const day = parts[2];
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô DD/MM/YYYY
                document.getElementById('date-display').value = `${day}/${month}/${year}`;
            } else {
                document.getElementById('date-display').value = '';
            }
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        // ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ input ‡∏à‡∏£‡∏¥‡∏á
        document.getElementById('date').value = `${yyyy}-${mm}-${dd}`;
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å
        updateDateDisplay();

        function readURL(input, previewId, resId) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(resId).src = e.target.result;
                    let preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function calc() {
            let n1 = document.getElementById('n1').value;
            let n2 = document.getElementById('n2').value;
            let dStr = document.getElementById('date').value; // ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input ‡∏à‡∏£‡∏¥‡∏á

            if(!n1 || !n2 || !dStr) { alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞"); return; }

            let start = new Date(dStr);
            let now = new Date();
            let diff = now - start;

            if(diff < 0) { alert("‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏¢‡∏±‡∏á‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ô‡∏∞!"); return; }

            let totalSec = Math.floor(diff / 1000);
            
            let years = now.getFullYear() - start.getFullYear();
            let months = now.getMonth() - start.getMonth();
            let days = now.getDate() - start.getDate();
            if (days < 0) { months--; days += new Date(now.getFullYear(), now.getMonth(), 0).getDate(); }
            if (months < 0) { years--; months += 12; }

            document.getElementById('names-show').innerText = `${n1} & ${n2}`;
            document.getElementById('y').innerText = years;
            document.getElementById('m').innerText = months;
            document.getElementById('d').innerText = days;
            document.getElementById('s').innerText = totalSec.toLocaleString();

            document.getElementById('modal').style.display = 'flex';
            
            for(let i=0; i<30; i++) setTimeout(createHeart, i*40);
        }

        function downloadImage() {
            const element = document.getElementById("capture-area");
            
            if (typeof html2canvas === 'undefined') {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏±‡∏ö");
                return;
            }

            html2canvas(element, { 
                scale: 3, 
                backgroundColor: null,
                useCORS: true,
                scrollY: 0, 
                scrollX: 0,
                windowHeight: element.scrollHeight,
                windowWidth: element.scrollWidth
            }).then(canvas => {
                const link = document.createElement("a");
                link.download = "our-love-story-ig.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(err => {
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô Browser ‡∏ô‡∏µ‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ Chrome ‡∏´‡∏£‡∏∑‡∏≠ Safari ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö");
            });
        }

        function showWebQR() {
            let url = window.location.href.split('?')[0];
            document.getElementById('qr-popup').style.display = 'flex';
            document.getElementById('qrcode').innerHTML = ""; 
            new QRCode(document.getElementById("qrcode"), { text: url, width: 200, height: 200 });
        }

        function closeQR() {
            document.getElementById('qr-popup').style.display = 'none';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function createHeart() {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.innerHTML = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üåπ', 'ü•∞'][Math.floor(Math.random() * 5)];
            heart.style.left = Math.random() * 100 + "vw";
            heart.style.animationDuration = Math.random() * 2 + 3 + "s";
            heart.style.fontSize = Math.random() * 20 + 20 + "px";
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 5000);
        }
        setInterval(createHeart, 600);
    </script>
</body>
</html>
