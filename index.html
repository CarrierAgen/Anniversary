<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Love Story ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Mali:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        * { box_sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Mali', cursive;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            background-color: #ffdde1;
            width: 100vw; height: 100vh; overflow: hidden; position: relative;
        }

        /* --- Card ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• --- */
        .card {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); 
            padding: 2rem; border-radius: 30px;
            box-shadow: 0 20px 50px rgba(255, 105, 180, 0.5); 
            text-align: center;
            width: 90%; max-width: 600px;
            z-index: 10; border: 5px solid #fff;
            max-height: 90vh; overflow-y: auto;
        }

        h1 { color: #ff4081; font-size: 2.5rem; margin-bottom: 1.5rem; }
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; color: #d81b60; font-weight: bold; margin-bottom: 5px; font-size: 1.2rem; text-align: center; }
        input {
            width: 100%; padding: 12px; border: 3px solid #ffc1e3; border-radius: 50px;
            font-family: 'Mali', cursive; text-align: center; background: #fff0f6; outline: none; font-size: 1.2rem;
        }

        .upload-row { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 20px; }
        .upload-btn {
            background: #ffb6c1; color: white; padding: 10px; border-radius: 15px;
            font-size: 1rem; cursor: pointer; width: 48%; text-align: center;
            border: 2px solid #ff69b4; display: flex; flex-direction: column; align-items: center;
        }
        input[type="file"] { display: none; }
        
        button {
            background: linear-gradient(45deg, #ff4081, #ff80ab); color: white; border: none;
            padding: 15px; font-size: 1.5rem; border-radius: 50px; cursor: pointer;
            width: 100%; margin-top: 10px; box-shadow: 0 5px 15px rgba(255, 64, 129, 0.4);
            font-family: 'Itim', cursive; transition: 0.3s;
        }
        button:hover { transform: translateY(-3px); }

        /* --- Pop-up ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; backdrop-filter: blur(5px);
            align-items: center; justify-content: center; overflow-y: auto;
        }
        
        .modal-content {
            background: white; padding: 20px; border-radius: 30px; width: 95%; 
            max-width: 500px; text-align: center; border: 8px solid #ffb6c1; position: relative;
            margin: auto; margin-top: 20px; margin-bottom: 20px;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡∏ü‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ */
        #capture-area {
            background: white; padding: 20px; border-radius: 20px;
        }

        .photo-couple { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; align-items: center; }
        .circle-img {
            width: 120px; height: 120px; border-radius: 50%; border: 5px solid #ff4081;
            object-fit: cover; background: #eee;
        }
        .heart-icon { font-size: 3rem; animation: pulse 1s infinite; color: #ff1493; }

        .time-box { background: #fff0f5; padding: 15px; border-radius: 20px; margin: 15px 0; border: 3px dashed #ff80ab; }
        .big-number { font-size: 2.5rem; font-weight: bold; color: #ff4081; }
        .unit-text { font-size: 1rem; color: #880e4f; }
        
        .seconds-box {
            background: linear-gradient(45deg, #ff4081, #ff80ab); color: white; 
            padding: 15px; border-radius: 20px; margin-top: 10px;
        }
        .seconds-number { font-size: 2rem; font-weight: bold; display: block; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .btn-group { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
        .dl-btn { background: #00bfff !important; font-size: 1.2rem; padding: 12px; box-shadow: 0 4px 10px rgba(0, 191, 255, 0.4); }
        /* ‡∏õ‡∏∏‡πà‡∏° QR ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .qr-btn { background: #28a745 !important; font-size: 1.2rem; padding: 12px; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.4); }
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
        .close-btn { background: #666 !important; font-size: 1rem; padding: 10px; }

        #qr-area { margin-top: 15px; padding: 15px; background: white; display: none; flex-direction: column; align-items: center; border-radius: 15px; border: 2px solid #ddd; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .heart { position: absolute; top: -100px; color: #ff4081; animation: fall linear forwards; z-index: 1; pointer-events: none; }
        @keyframes fall { to { transform: translateY(120vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div class="card">
        <h1>üíò Love Calculator</h1>

        <div class="upload-row">
            <label class="upload-btn">
                <span>üì∏ ‡∏£‡∏π‡∏õ‡∏Ñ‡∏∏‡∏ì</span>
                <input type="file" id="p1" accept="image/*" onchange="readURL(this, 'preview1', 'img1_res')">
                <img id="preview1" style="width:40px; height:40px; border-radius:50%; display:none; margin-top:5px; object-fit:cover;">
            </label>
            <label class="upload-btn">
                <span>üì∏ ‡∏£‡∏π‡∏õ‡πÅ‡∏ü‡∏ô</span>
                <input type="file" id="p2" accept="image/*" onchange="readURL(this, 'preview2', 'img2_res')">
                <img id="preview2" style="width:40px; height:40px; border-radius:50%; display:none; margin-top:5px; object-fit:cover;">
            </label>
        </div>

        <div class="input-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
            <input type="text" id="n1" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏µ‡πà‡πÇ‡∏ä‡∏ô" value="‡πÄ‡∏Ñ‡πâ‡∏≤">
        </div>
        <div class="input-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å</label>
            <input type="text" id="n2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥" value="‡πÄ‡∏ï‡∏á">
        </div>
        <div class="input-group">
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô</label>
            <input type="date" id="date">
        </div>

        <button onclick="calc()">‚ù§Ô∏è ‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‚ù§Ô∏è</button>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            
            <div id="capture-area">
                <div class="photo-couple">
                    <img id="img1_res" class="circle-img" src="https://via.placeholder.com/150?text=Me">
                    <div class="heart-icon">‚ù§Ô∏è</div>
                    <img id="img2_res" class="circle-img" src="https://via.placeholder.com/150?text=You">
                </div>

                <h2 id="names-show" style="color:#d81b60; font-size: 2rem; margin-bottom: 10px;"></h2>
                
                <div class="time-box">
                    <span id="y" class="big-number">0</span> <span class="unit-text">‡∏õ‡∏µ</span> &nbsp;
                    <span id="m" class="big-number">0</span> <span class="unit-text">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span> &nbsp;
                    <span id="d" class="big-number">0</span> <span class="unit-text">‡∏ß‡∏±‡∏ô</span>
                </div>

                <div class="seconds-box">
                    <div style="font-size: 1rem;">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <span id="s" class="seconds-number">0</span>
                </div>
            </div>
            <div id="qr-area">
                <div id="qrcode"></div>
                <small style="color:red; margin-top:10px;">*‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ*</small>
            </div>

            <div class="btn-group">
                <button class="dl-btn" onclick="downloadImage()">üì• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                <button class="qr-btn" onclick="makeQR()">üì≤ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÉ‡∏´‡πâ‡πÅ‡∏ü‡∏ô</button>
                <button class="close-btn" onclick="closeModal()">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
            </div>

        </div>
    </div>

    <script>
        document.getElementById('date').valueAsDate = new Date();

        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            if(params.has('n1')) {
                document.getElementById('n1').value = decodeURIComponent(params.get('n1'));
                document.getElementById('n2').value = decodeURIComponent(params.get('n2'));
                document.getElementById('date').value = params.get('d');
                calc();
            }
        }

        function readURL(input, previewId, resId) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(resId).src = e.target.result;
                    let preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function calc() {
            let n1 = document.getElementById('n1').value;
            let n2 = document.getElementById('n2').value;
            let dStr = document.getElementById('date').value;

            if(!n1 || !n2 || !dStr) { alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞"); return; }

            let start = new Date(dStr);
            let now = new Date();
            let diff = now - start;

            if(diff < 0) { alert("‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏¢‡∏±‡∏á‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ô‡∏∞!"); return; }

            let totalSec = Math.floor(diff / 1000);
            
            let years = now.getFullYear() - start.getFullYear();
            let months = now.getMonth() - start.getMonth();
            let days = now.getDate() - start.getDate();
            if (days < 0) { months--; days += new Date(now.getFullYear(), now.getMonth(), 0).getDate(); }
            if (months < 0) { years--; months += 12; }

            document.getElementById('names-show').innerText = `${n1} & ${n2}`;
            document.getElementById('y').innerText = years;
            document.getElementById('m').innerText = months;
            document.getElementById('d').innerText = days;
            document.getElementById('s').innerText = totalSec.toLocaleString();

            document.getElementById('modal').style.display = 'flex';
            
            for(let i=0; i<30; i++) setTimeout(createHeart, i*40);
        }

        function downloadImage() {
            const element = document.getElementById("capture-area");
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î library ‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (typeof html2canvas === 'undefined') {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏ã‡∏ü‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö");
                return;
            }

            html2canvas(element, { 
                scale: 2,
                backgroundColor: "#ffffff"
            }).then(canvas => {
                const link = document.createElement("a");
                link.download = "love-memory.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(err => {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ: " + err);
            });
        }

        function makeQR() {
            let n1 = encodeURIComponent(document.getElementById('n1').value);
            let n2 = encodeURIComponent(document.getElementById('n2').value);
            let d = document.getElementById('date').value;
            let url = window.location.href.split('?')[0] + `?n1=${n1}&n2=${n2}&d=${d}`;
            
            document.getElementById('qr-area').style.display = 'flex';
            document.getElementById('qrcode').innerHTML = ""; 
            new QRCode(document.getElementById("qrcode"), { text: url, width: 120, height: 120 });
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('qr-area').style.display = 'none';
        }

        function createHeart() {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.innerHTML = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üåπ', 'ü•∞'][Math.floor(Math.random() * 5)];
            heart.style.left = Math.random() * 100 + "vw";
            heart.style.animationDuration = Math.random() * 2 + 3 + "s";
            heart.style.fontSize = Math.random() * 20 + 20 + "px";
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 5000);
        }
        setInterval(createHeart, 600);
    </script>
</body>
</html>
